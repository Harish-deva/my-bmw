define("ds2-tracking-save-configuration",["jquery","ds2-tracking-base","ds2-tracking"],function(c,d,h){c.widget("digitals2.ds2TrackingSaveconfiguration",d,{_create:function(){var e=this._super(),a=this;console.log("1");if(0<c("#ds2-configuration-save").length)c("#ds2-configuration-save").on("ds2-open-save-configuration-popup",function(b){a._trackPopupSaveConfig(b)});if(0<c("#configuration-save--button--save").length)c("#configuration-save--button--save").on("click",function(b){a._trackPopupSaveConfig(b)});
if(0<c("#configuration-save--button--cancel").length)c("#configuration-save--button--cancel").on("click",function(b){a._trackPopupSaveConfig(b)});if(0<c("#configuration-save--modal-close").length)c("#configuration-save--modal-close").on("click",function(b){a._trackPopupSaveConfig(b)});return e},_trackPopupSaveConfig:function(c){var a=this._getTrackingEventData(c.target),b=this._getTrackOptionsData(c.target);a&&b&&(b=this.bmwTrackOptionsBuilder.options().name(a.eventInfo.track||b.name).active(b.content.active).build(),
a=this._populateClickEvent(c,b.name,a.eventInfo.target,a.eventInfo.eventName,a.eventInfo.cause,a.eventInfo.effect),this._parseDataFromEvent(a,b,c,!0))},_getTrackingEventData:function(e){return c(e).data("tracking-event")||null},_getTrackOptionsData:function(e){return c(e).data("tracking-options")||null}});return function(c){c.ds2TrackingSaveconfiguration(h.getOptions("ds2-configuration-save"))}});
define("ds2-save-configuration",["jquery","lodash","ds2-tracking-save-configuration","postal"],function(c,d,h,e){function a(b){if(this.isConfigSaveAvailable()){this.$element=c(b);this.$h5vcoSaveButton=c("#h5vco-save-button");this.$navigationLink=c(".ds2-navigation-main--link");this.uxnHeader=c(".top-navigation");this.uxnFooter=c(".the-footer");this.$footerLink=c(".ds2-main-footer--link");this.$closeButton=this.$element.find("#configuration-save--modal-close");this.$saveButton=this.$element.find("#configuration-save--button--save");
this.$cancelButton=this.$element.find("#configuration-save--button--cancel");this.$carName=this.$element.find("#configuration-save--car-name");this.$previewImg=this.$element.find("#configuration-save--preview-image");this.imageTemplate=d.template('\x3cimg class\x3d"configuration-save-car-img" src\x3d"\x3c%- src %\x3e"/\x3e');this.addEventUxnHeader=this.addEventUxnFooter=!1;var a=this,f=function(b){if(!c(b.target).hasClass("close-icon")){c(b.target).attr("href");c(b.target).attr("target");var g=0<
c(b.target).find(".hover-indicator").length;if("A"==b.target.nodeName){var f=c(b.target).attr("href");var d=c(b.target).attr("target");g=0<c(b.target).find(".hover-indicator").length}else d=c(b.target).closest("a"),f=c(d).attr("href"),d=c(d).attr("target");a.openModalClick(f,d,g,b)}};e.subscribe({channel:"header",topic:"NavigationRendered",callback:function(b){1==b.loadedHeader&&(a.uxnHeader=c(".top-navigation"),0<a.uxnHeader.length&&!a.addEventUxnHeader&&(a.uxnHeader[0].addEventListener("click",
f,!0),a.addEventUxnHeader=!0));1==b.loadedFooter&&(a.uxnFooter=c(".the-footer"),0<a.uxnFooter.length&&!a.addEventUxnFooter&&(a.uxnFooter[0].addEventListener("click",f,!0),a.addEventUxnFooter=!0))}.bind(this)});this.$navigationLink.on("click",this.openModalOnLinkClick.bind(this));this.$footerLink.on("click",this.openModalOnLinkClick.bind(this));this.$closeButton.on("click",this.setVisibility.bind(this,!1));this.$saveButton.on("click",d.flow(this.saveConfiguration,this.setVisibility.bind(this,!1)));
this.$cancelButton.on("click",d.flow(this.cancelConfiguration,this.setHref.bind(this),this.setVisibility.bind(this,!1)));h(this.$element)}}a.prototype.isConfigSaveAvailable=function(){return c("body").hasClass("ds2-page--h5vco")&&0<c("#ds2-configuration-save").length};a.prototype.isUXNFooterAndHeader=function(){return 0<this.uxnHeader.length||0<this.uxnFooter.length};a.prototype.openModalOnLinkClick=function(b){var a=c(b.target).attr("href"),d=c(b.target).attr("target");return this.openModalClick(a,
d,!1,b)};a.prototype.openModalClick=function(b,a,c,d){if(!(!this.isInCorrectStep()||"#"===b||""==b||this.isUXNFooterAndHeader()&&c))return d.stopImmediatePropagation(),d.preventDefault(),this.openModal(b,a),!1};a.prototype.openModal=function(b,a){this.href=b;this.target=a;this.setVisibility(!0);this.$carName.text(this.getConfiguredCarName());b=this.getConfiguredCarImage();this.$previewImg.empty();b&&this.$previewImg.append(this.imageTemplate({src:b}))};a.prototype.setHref=function(){this.isUXNFooterAndHeader()?
"_blank"===this.target?window.open(this.href,this.target):window.location=this.href:window.location.href=this.href};a.prototype.saveConfiguration=function(){window.ds2configurator&&window.ds2configurator.$&&window.ds2configurator.$.publish("h5vco.garage.saveToMyGarage")};a.prototype.isInCorrectStep=function(){var b;window.consentcontroller&&window.consentcontroller.api&&(b=window.consentcontroller.api.getPersistence("Garage"));try{var a=b&&JSON.parse(b).savedConfiguration}catch(f){console.error(f)}return!a&&
this.$h5vcoSaveButton.hasClass("h5vco-enabled")};a.prototype.cancelConfiguration=function(){};a.prototype.setVisibility=function(b,a){a&&"function"===typeof a.preventDefault&&(a.preventDefault(),a.stopImmediatePropagation());b?this.$element.addClass("visible"):this.$element.removeClass("visible")};a.prototype.getCurrentConfig=function(){var a;window.consentcontroller&&window.consentcontroller.api&&(a=window.consentcontroller.api.getPersistence("h5vco.configurations.currentConfig"));if(a)try{return JSON.parse(a)}catch(g){console.error(g)}};
a.prototype.getConfiguredCarName=function(){return d.get(this.getCurrentConfig(),"configData.description")};a.prototype.getConfiguredCarImage=function(){return d.get(this.getCurrentConfig(),"configData.cosyImageUrls.FRONTSIDE_VIEW")};return a});